!function(e){"use strict";e.eac_api=e.eac_api||{};const t=Backbone.Model.extend({apiRoot:eac_api_vars.root||"/wp-json",namespace:"eac/v1",endpoint:"",nonce:eac_api_vars.nonce||"",url(){let e=this.apiRoot.replace(/\/+$/,"")+"/"+this.namespace.replace(/\/+$/,"")+"/"+this.endpoint.replace(/\/+$/,"");return _.isUndefined(this.get("id"))||(e+="/"+this.get("id")),e.replace(/\/+$/,"")},sync(e,t,a){let n;return a=a||{},_.isUndefined(a.cache)&&(a.cache=!0),_.isEmpty(t.nonce)||(n=a.beforeSend,a.beforeSend=function(e){if(e.setRequestHeader("X-WP-Nonce",t.nonce),n)return n.apply(this,arguments)},a.complete=function(e){const a=e.getResponseHeader("X-WP-Nonce");a&&_.isEmpty(t.nonce)&&t.nonce!==a&&t.set("nonce",a)}),Backbone.sync(e,t,a)}});eac_api.Model=t,eac_api.Account=t.extend({endpoint:"accounts",defaults:{id:"",type:"bank",name:"",number:"",opening_balance:0,bank_name:"",bank_phone:"",bank_address:"",currency_code:"USD",creator_id:"",thumbnail_id:"",status:"active",updated_at:"",created_at:""}}),eac_api.Contact=t.extend({endpoint:"contacts",defaults:{id:null,type:"customer",name:"",company:"",email:"",phone:"",website:"",address:"",city:"",state:"",postcode:"",country:"",vat_number:"",vat_exempt:!1,currency_code:"",thumbnail_id:null,user_id:null,status:"active",created_via:"api",creator_id:null,updated_at:"",created_at:""}}),eac_api.Customer=eac_api.Contact.extend({endpoint:"customers",defaults:Object.assign({},eac_api.Contact.prototype.defaults,{type:"customer"})}),eac_api.Category=t.extend({endpoint:"categories",defaults:{id:null,type:"",name:"",description:"",status:"",updated_at:"",created_at:""}}),eac_api.Document=t.extend({defaults:{id:"",type:"",status:"draft",number:"",reference:"",subtotal:0,discount:0,tax:0,total:0,discount_value:0,discount_type:"fixed",contact_id:"",contact_name:"",contact_company:"",contact_email:"",contact_phone:"",contact_address:"",contact_city:"",contact_state:"",contact_zip:"",contact_country:"",contact_tax_number:"",note:"",terms:"",issue_date:"",due_date:"",sent_date:"",payment_date:"",currency_code:"",exchange_rate:"",created_via:"",creator_id:"",uuid:"",updated_at:"",created_at:"",items:eac_api.DocumentItems,is_fetching:!1},getNextNumber(e={}){return this.fetch({url:`${this.apiRoot}${this.namespace}/utilities/next-number?type=${this.get("type")}`,type:"GET",...e})},updateAmounts(){console.log("=== Bill.updateAmounts() ===");let e=0,t=0,a=0,n=0,c=0,o=this.get("discount_type")||"fixed",i=parseFloat(this.get("discount_value"),10)||0;_.each(this.get("items").models,(t=>{const a=parseFloat(t.get("price"),10)||0,n=parseFloat(t.get("quantity"),10)||0,c=a*n,o=t.get("type")||"standard";"standard"===o&&(e+=c),t.set({price:a,quantity:n,subtotal:c,type:o,discount:0})})),a="percent"===o?e*i/100:i,a=a>e?e:a,_.each(this.get("items").models,(c=>{const o=c.get("type")||"standard",i=c.get("subtotal")||0,d="standard"===o?a/e*i:0,s=Math.max(i-d,0);_.each(c.get("taxes").models,(e=>{const t=parseFloat(e.get("rate"),10)||0,a=e.get("compound")?0:s*(t/100);e.set({rate:t,amount:a})}));const p=_.reduce(c.get("taxes").models,((e,t)=>e+t.get("amount")),0);_.each(c.get("taxes").where({compound:!0}),(e=>{const t=parseFloat(e.get("rate"),10)||0,a=(s+p)*(t/100);e.set({rate:t,amount:a})}));const u=_.reduce(c.get("taxes").models,((e,t)=>e+t.get("amount")),0);c.set({discount:d,subtotal:s,tax:u,total:s+u}),t+=s,n+=u})),c=t+n,this.set({subtotal:t,discount:a,tax:n,total:c})}}),eac_api.DocumentItem=t.extend({endpoint:"line-items",defaults:{id:null,type:"standard",name:"",price:0,quantity:1,subtotal:0,discount:0,tax:0,total:0,desc:"",unit:"",item_id:null,updated_at:"",created_at:"",taxes:[]}}),eac_api.DocumentTax=t.extend({endpoint:"line-taxes",defaults:{id:null,name:"",rate:0,compound:!1,amount:0,item_id:0,tax_id:0,document_id:0,updated_at:"",created_at:""}}),eac_api.Invoice=eac_api.Document.extend({defaults:Object.assign({},eac_api.Document.prototype.defaults,{type:"invoice"})}),eac_api.Bill=eac_api.Document.extend({defaults:Object.assign({},eac_api.Document.prototype.defaults,{type:"bill"})}),eac_api.Transaction=t.extend({endpoint:"transactions",defaults:{id:"",type:"expense",status:"draft",number:"",contact_id:"",account_id:"",amount:0,currency_code:"",exchange_rate:"",reference:"",note:"",date:"",created_via:"",creator_id:"",uuid:"",updated_at:"",created_at:""}}),eac_api.Payment=eac_api.Transaction.extend({endpoint:"payments",defaults:Object.assign({},eac_api.Transaction.prototype.defaults,{type:"payment"})}),eac_api.Expense=eac_api.Transaction.extend({defaults:Object.assign({},eac_api.Transaction.prototype.defaults,{type:"expense"})}),eac_api.Item=t.extend({endpoint:"items",defaults:{id:"",name:"",description:"",price:0,unit:"",updated_at:"",created_at:""}}),eac_api.Tax=t.extend({endpoint:"taxes",defaults:{id:"",name:"",rate:0,compound:!1,updated_at:"",created_at:""}}),eac_api.Note=t.extend({endpoint:"notes",defaults:{id:"",type:"",object_id:"",content:"",updated_at:"",created_at:""}}),eac_api.Vendor=eac_api.Contact.extend({endpoint:"vendors",defaults:Object.assign({},eac_api.Contact.prototype.defaults,{type:"vendor"})});const a=Backbone.Collection.extend({apiRoot:eac_api_vars.root||"/wp-json",namespace:eac_api_vars.namespace||"eac/v1",endpoint:"",nonce:eac_api_vars.nonce||"",preinitialize(e,t){this.options=t},url(){return this.apiRoot.replace(/\/+$/,"")+"/"+this.namespace.replace(/\/+$/,"")+"/"+this.endpoint.replace(/\/+$/,"")},sync(e,t,a){let n;return a=a||{},_.isUndefined(a.cache)&&(a.cache=!0),_.isEmpty(t.nonce)||(n=a.beforeSend,a.beforeSend=function(e){if(e.setRequestHeader("X-WP-Nonce",t.nonce),n)return n.apply(this,arguments)},a.complete=function(e){const a=e.getResponseHeader("X-WP-Nonce");_.isEmpty(a)||(t.nonce=a)}),Backbone.sync(e,t,a)}});eac_api.Collection=a,eac_api.Accounts=a.extend({endpoint:"accounts",model:eac_api.Account}),eac_api.Contacts=a.extend({endpoint:"contacts",model:eac_api.Contact}),eac_api.Customers=a.extend({endpoint:"customers",model:eac_api.Customer}),eac_api.Categories=a.extend({endpoint:"categories",model:eac_api.Category}),eac_api.Documents=a.extend({endpoint:"documents",model:eac_api.Document}),eac_api.DocumentItems=a.extend({endpoint:"document/items",model:eac_api.DocumentItem}),eac_api.DocumentTaxes=a.extend({endpoint:"line-taxes",model:eac_api.DocumentTax}),eac_api.DocumentAddresses=a.extend({endpoint:"addresses",model:eac_api.DocumentAddress}),eac_api.Invoices=a.extend({endpoint:"invoices",model:eac_api.Invoice}),eac_api.Bills=a.extend({endpoint:"bills",model:eac_api.Bill}),eac_api.Transactions=a.extend({endpoint:"transactions",model:eac_api.Transaction}),eac_api.Payments=a.extend({endpoint:"payments",model:eac_api.Payment}),eac_api.Expenses=a.extend({endpoint:"expenses",model:eac_api.Expense}),eac_api.Items=a.extend({endpoint:"items",model:eac_api.Item}),eac_api.Taxes=a.extend({endpoint:"taxes",model:eac_api.Tax}),eac_api.Notes=a.extend({endpoint:"notes",model:eac_api.Note}),eac_api.Vendors=a.extend({endpoint:"vendors",model:eac_api.Vendor})}(window);